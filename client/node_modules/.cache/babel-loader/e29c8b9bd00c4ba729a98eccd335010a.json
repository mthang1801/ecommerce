{"ast":null,"code":"var _jsxFileName = \"/home/mvt/Desktop/projects/mern-stack/e-commerce/client/src/components/Product-Detail/comment-reviews/comment-reviews.component.jsx\";\nimport React, { useEffect, useState, useRef } from \"react\";\nimport { getCommentReviewsByProductId } from \"../../../utils/connectDB\";\nimport Spinner from \"../../UI/spinner/spinner.component\";\nimport { CommentReviewsWrapper, TextArea, CommentsGet, ReadMore, ButtonReadMore, CommentsPost } from \"./comment-reviews.styles\";\nimport CommentReviewsItem from \"../comment-reviews-item/comment-reviews-item.component\";\nimport Button from \"@material-ui/core/Button\";\nimport { connect } from \"react-redux\";\nimport { selectCommentsLoading, selectComments, selectCommentReviewsError, selectNumberOfComments } from \"../../../redux/product-comment-review/product-comment-review.selectors\";\nimport { selectProductDetailData } from \"../../../redux/product-detail/product-detail.selectors\";\nimport { createStructuredSelector } from \"reselect\";\nimport { fetchProductCommentReview, fetchMoreComments } from \"../../../redux/product-comment-review/product-comment-review.actions\";\nimport PopupLoader from \"../../UI/popup-loader/popup-loader.component\";\n\nconst CommentReviews = ({\n  product,\n  show,\n  productId,\n  comments,\n  loading,\n  error,\n  fetchProductCommentReview,\n  readMore,\n  setReadMore,\n  setTaskHeight,\n  numberOfComments,\n  fetchMoreComments\n}) => {\n  const commentsRef = useRef(null);\n  const [showReadMore, setShowReadMore] = useState(false);\n  const [commentItemHeight, setCommentItemHeight] = useState(0);\n  const [readMoreComments, setReadMoreComments] = useState(false);\n  useEffect(() => {\n    if (numberOfComments > comments.length) {\n      setReadMoreComments(true);\n    } else {\n      setReadMoreComments(false);\n    }\n  }, [numberOfComments, comments]);\n  useEffect(() => {\n    let _mounted = true;\n\n    if (productId) {\n      fetchProductCommentReview(productId);\n    }\n\n    if (commentsRef.current.scrollHeight > commentsRef.current.clientHeight) {\n      setShowReadMore(true);\n      setTaskHeight(commentsRef.current.scrollHeight + commentItemHeight);\n    }\n\n    return () => {\n      _mounted = false;\n    };\n  }, [productId]);\n\n  const handleClickReadMoreComments = e => {\n    e.preventDefaul();\n    fetchMoreComments(product._id, comments.length);\n  };\n\n  return /*#__PURE__*/React.createElement(CommentReviewsWrapper, {\n    ref: commentsRef,\n    show: show,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 68,\n      columnNumber: 5\n    }\n  }, loading && !comments.length ? /*#__PURE__*/React.createElement(Spinner, {\n    loadChildComponent: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 70,\n      columnNumber: 9\n    }\n  }) : /*#__PURE__*/React.createElement(React.Fragment, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 72,\n      columnNumber: 9\n    }\n  }, loading ? /*#__PURE__*/React.createElement(PopupLoader, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 73,\n      columnNumber: 22\n    }\n  }) : null, /*#__PURE__*/React.createElement(CommentsPost, {\n    show: show,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 74,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(TextArea, {\n    placeholder: \"\\u0110\\u1EC3 l\\u1EA1i b\\xECnh lu\\u1EADn c\\u1EE7a b\\u1EA1n t\\u1EA1i \\u0111\\xE2y\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 75,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(Button, {\n    color: \"primary\",\n    variant: \"contained\",\n    size: \"small\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 76,\n      columnNumber: 13\n    }\n  }, \"G\\u1EEDi\")), /*#__PURE__*/React.createElement(CommentsGet, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 80,\n      columnNumber: 11\n    }\n  }, comments.length ? comments.map(comment => {\n    return /*#__PURE__*/React.createElement(CommentReviewsItem, {\n      key: comment._id,\n      comment: comment,\n      product: product,\n      setCommentItemHeight: value => setCommentItemHeight(value),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 84,\n        columnNumber: 21\n      }\n    });\n  }) : null), readMoreComments ? /*#__PURE__*/React.createElement(ButtonReadMore, {\n    onClick: handleClickReadMoreComments,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 31\n    }\n  }, \"Xem th\\xEAm b\\xECnh lu\\u1EADn\") : null), showReadMore ? /*#__PURE__*/React.createElement(ReadMore, {\n    onClick: () => setReadMore(true),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 9\n    }\n  }, !readMore ? \"Xem thêm\" : \"Thu gọn\") : null);\n};\n\nconst mapStateToProps = createStructuredSelector({\n  comments: selectComments,\n  loading: selectCommentsLoading,\n  error: selectCommentReviewsError,\n  product: selectProductDetailData,\n  numberOfComments: selectNumberOfComments\n});\n\nconst mapDispatchToProps = dispatch => ({\n  fetchProductCommentReview: productId => dispatch(fetchProductCommentReview(productId)),\n  fetchMoreComments: (productId, skip) => dispatch(fetchMoreComments(productId, skip))\n});\n\nexport default connect(mapStateToProps, mapDispatchToProps)(CommentReviews);","map":{"version":3,"sources":["/home/mvt/Desktop/projects/mern-stack/e-commerce/client/src/components/Product-Detail/comment-reviews/comment-reviews.component.jsx"],"names":["React","useEffect","useState","useRef","getCommentReviewsByProductId","Spinner","CommentReviewsWrapper","TextArea","CommentsGet","ReadMore","ButtonReadMore","CommentsPost","CommentReviewsItem","Button","connect","selectCommentsLoading","selectComments","selectCommentReviewsError","selectNumberOfComments","selectProductDetailData","createStructuredSelector","fetchProductCommentReview","fetchMoreComments","PopupLoader","CommentReviews","product","show","productId","comments","loading","error","readMore","setReadMore","setTaskHeight","numberOfComments","commentsRef","showReadMore","setShowReadMore","commentItemHeight","setCommentItemHeight","readMoreComments","setReadMoreComments","length","_mounted","current","scrollHeight","clientHeight","handleClickReadMoreComments","e","preventDefaul","_id","map","comment","value","mapStateToProps","mapDispatchToProps","dispatch","skip"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useRef } from \"react\";\nimport { getCommentReviewsByProductId } from \"../../../utils/connectDB\";\nimport Spinner from \"../../UI/spinner/spinner.component\";\nimport {\n  CommentReviewsWrapper,\n  TextArea,\n  CommentsGet,\n  ReadMore,\n  ButtonReadMore, \n  CommentsPost,\n} from \"./comment-reviews.styles\";\nimport CommentReviewsItem from \"../comment-reviews-item/comment-reviews-item.component\";\nimport Button from \"@material-ui/core/Button\";\nimport { connect } from \"react-redux\";\nimport {\n  selectCommentsLoading,\n  selectComments,\n  selectCommentReviewsError,\n  selectNumberOfComments,\n} from \"../../../redux/product-comment-review/product-comment-review.selectors\";\nimport { selectProductDetailData } from \"../../../redux/product-detail/product-detail.selectors\";\nimport { createStructuredSelector } from \"reselect\";\nimport { fetchProductCommentReview, fetchMoreComments } from \"../../../redux/product-comment-review/product-comment-review.actions\";\nimport PopupLoader from \"../../UI/popup-loader/popup-loader.component\"\nconst CommentReviews = ({\n  product,\n  show,\n  productId,\n  comments,\n  loading,\n  error,\n  fetchProductCommentReview,\n  readMore,\n  setReadMore,\n  setTaskHeight,\n  numberOfComments,\n  fetchMoreComments\n}) => {  \n  const commentsRef = useRef(null);\n  const [showReadMore, setShowReadMore] = useState(false);\n  const [commentItemHeight, setCommentItemHeight] = useState(0);\n  const [readMoreComments, setReadMoreComments] = useState(false);\n  useEffect(() => {    \n    if(numberOfComments > comments.length){\n      setReadMoreComments(true);\n    }else{\n      setReadMoreComments(false);\n    }\n  } , [numberOfComments, comments])  \n  useEffect(() => {\n    let _mounted = true;\n    if (productId) {\n      fetchProductCommentReview(productId);\n    }\n    if (commentsRef.current.scrollHeight > commentsRef.current.clientHeight) {\n      setShowReadMore(true);\n      setTaskHeight(commentsRef.current.scrollHeight + commentItemHeight);\n    }\n    return () => {\n      _mounted = false;\n    };\n  }, [productId]);\n  const handleClickReadMoreComments = (e) => {\n    e.preventDefaul();\n    fetchMoreComments(product._id, comments.length)\n  }\n  return (\n    <CommentReviewsWrapper ref={commentsRef} show={show}>\n      {loading && !comments.length? (\n        <Spinner loadChildComponent />\n      ) : (\n        <React.Fragment>  \n          {loading ? <PopupLoader /> : null}\n          <CommentsPost show={show}>\n            <TextArea placeholder=\"Để lại bình luận của bạn tại đây\" />\n            <Button color=\"primary\" variant=\"contained\" size=\"small\">\n              Gửi\n            </Button>\n          </CommentsPost>\n          <CommentsGet>\n            {comments.length\n              ? comments.map((comment) => {\n                  return (\n                    <CommentReviewsItem\n                      key={comment._id}\n                      comment={comment}\n                      product={product}\n                      setCommentItemHeight={(value) =>\n                        setCommentItemHeight(value)\n                      }\n                    />\n                  );\n                })\n              : null}\n          </CommentsGet>\n          {readMoreComments ? <ButtonReadMore onClick={handleClickReadMoreComments}>Xem thêm bình luận</ButtonReadMore> : null}\n        </React.Fragment>\n      )}\n      {showReadMore ? (\n        <ReadMore onClick={() => setReadMore(true)}>\n          {!readMore ? \"Xem thêm\" : \"Thu gọn\"}\n        </ReadMore>\n      ) : null}\n    </CommentReviewsWrapper>\n  );\n};\n\nconst mapStateToProps = createStructuredSelector({\n  comments: selectComments,\n  loading: selectCommentsLoading,\n  error: selectCommentReviewsError,\n  product: selectProductDetailData,\n  numberOfComments: selectNumberOfComments,\n});\nconst mapDispatchToProps = (dispatch) => ({\n  fetchProductCommentReview: (productId) =>\n    dispatch(fetchProductCommentReview(productId)),\n    fetchMoreComments : (productId, skip) => dispatch(fetchMoreComments(productId, skip))\n});\nexport default connect(mapStateToProps, mapDispatchToProps)(CommentReviews);\n"]},"metadata":{},"sourceType":"module"}